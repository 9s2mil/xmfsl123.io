<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <link rel="manifest" href="./manifest.json">
  <link rel="stylesheet" href="plan.css">
  <link rel="stylesheet" href="play.css">
  <meta name="theme-color" content="#ffffff">
  <title>Puzzle and Plan</title>
</head>

<body>

<header id="appHeader" class="app-header">
  <!-- 좌측: 아바타 + 리더 -->
  <div class="hdr-left">
    <div class="avatar" id="headerAvatar" aria-label="프로필 이미지">
      <img src="icons/avatar.png" alt="리더 아바타" class="avatar-img">
    </div>
    <div class="leader" id="headerLeaderText"> </div>
  </div>

  <!-- 우측: 닉네임/랭크/키/케레이 -->
  <div class="hdr-right">
    <div class="row nick">
      <span id="headerNickname">닉네임 설정</span>
      <input id="nickInput" class="nick-input" type="text" maxlength="20" placeholder="닉네임" />
    </div>

    <div class="row meta">
      <span class="label">랭크</span>
      <strong id="headerRank">1</strong>
    </div>

    <div class="row keray">
      <span class="label">케레이</span>
      <strong id="hdrKeray">0</strong>
    </div>

    <div class="row keys">
      <div class="key chip">
        <img class="key-icon" src="icons/key-rose.png" alt="로즈키">
        <strong id="hdrRose">0</strong>
      </div>
      <div class="key chip">
        <img class="key-icon" src="icons/key-silver.png" alt="실버키">
        <strong id="hdrSilver">0</strong>
      </div>
      <div class="key chip">
        <img class="key-icon" src="icons/key-gold.png" alt="골드키">
        <strong id="hdrGold">0</strong>
      </div>
    </div>
  </div>
</header>

  <!-- -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->

  <main class="main-container">
    <div class="main-buttons">
      <button class="main-btn" id="btnAdventure">모험</button>
      <button class="main-btn" id="btnCardTeam">도감</button>
    </div>
  </main>

  <!-- 모험 전체 화면 -->
<div id="adventureScreen" class="adventure-screen" style="display:none;">

  <!-- 상단 UI -->
  <div class="adventure-header">
    <button class="btn-home">⇦</button>
    <button id="btnToggleFooterZ" class="btn-toggle-footer">Rank 1</button>
    <div class="key-count"><img class="key-icon" src="icons/key-rose.png" alt="로즈키"> <span id="roseKeyCount">0</span></div>
  </div>

  <!-- 적 일러스트 영역 -->
  <div class="enemy-area">
    <div class="enemy-hp-bar">
      <div class="enemy-hp-fill"></div>
      <span class="enemy-hp-text">0 / 0</span>
    </div>
    <div class="enemy-grid">
      <div class="monster-slot" id="monster-left">
        <img src="enemy/a11.png" alt="enemy default">
        <div class="enemy-turn"></div>
      </div>
      <div class="monster-slot" id="monster-center">
        <img src="enemy/a21.png" alt="enemy default">
        <div class="enemy-turn"></div>
      </div>
      <div class="monster-slot" id="monster-right">
        <img src="enemy/a11.png" alt="enemy default">
        <div class="enemy-turn"></div>
      </div>
    </div>
  </div>

  <!-- 아군 카드 영역 -->
  <div class="ally-team">
    <div class="ally-slot" id="h1">
      <img src="icons/h1.png" alt="ally 1">
      <button class="ally-button"></button>
    </div>
    <div class="ally-slot" id="h2">
      <img src="icons/h2.png" alt="ally2">
      <button class="ally-button"></button>
    </div>
    <div class="ally-slot" id="h3">
      <img src="icons/h3.png" alt="ally3">
      <button class="ally-button"></button>
    </div>
    <div class="ally-slot" id="h4">
      <img src="icons/h4.png" alt="ally4">
      <button class="ally-button"></button>
    </div>
    <div class="ally-slot" id="h5">
      <img src="icons/h5.png" alt="ally5">
      <button class="ally-button"></button>
    </div>
    <div class="ally-slot" id="h6">
      <img src="icons/h6.png" alt="ally6">
      <button class="ally-button"></button>
    </div>
  </div>

  <!-- HP 바 -->
  <div class="hp-bar">
    <div class="hp-fill"></div>
    <span class="hp-text">0 / 0</span>
  </div>

  <!-- 퍼즐판 -->
  <div class="puzzle-board">
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>

    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>

    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>

    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>

    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
    <div class="puzzle-slot"></div>
  </div>

  <!-- 스킬 게이지 -->
  <div class="skill-gauge">
    <div class="skill-segment"></div>
    <div class="skill-segment"></div>
    <div class="skill-segment"></div>
    <div class="skill-segment"></div>
    <div class="skill-segment"></div>
    <div class="skill-segment"></div>
    <div class="skill-segment"></div>
  </div>

</div>

  <!-- 1단계: 카드 - 팀편성 팝업 -->
  <div class="popup" id="CardTeam">
    <div class="popupContent">
      <h2>도감</h2>
      <button id="btnGoHome">🏠 홈으로</button>1
      <button id="btnBestiary">적도감</button>
      <button onclick="resetAllLocalStorage()">전체 초기화</button>
      <button onclick="resetAllyIconsToDefault()">아이콘 초기화</button>
    </div>
  </div>

<footer>
  <button data-popup="popup1">✅<br><span class="smft">일일 과제</span></button>
  <button data-popup="popup2">🌱<br><span class="smft">습관</span></button>
  <button data-popup="popup3">🏆<br><span class="smft">목표</span></button>
  <button data-popup="popup4">🎁<br><span class="smft">보상</span></button>
</footer>

  <div class="popup" id="popup1">
    <div class="popupContent">
      <h2>일일 과제</h2><br> <button id="diamond1" class="addbutton">🗡️</button>
      <div class="taskList" data-for="popup1"></div>
    </div>
  </div>

  <div class="popup" id="popup2">
    <div class="popupContent">
      <h2>습관</h2><br> <button id="diamond2" class="addbutton">🗡️</button>
      <div class="taskList" data-for="popup2"></div>
    </div>
  </div>

  <div class="popup" id="popup3">
    <div class="popupContent">
      <h2>목표</h2><br> <button id="diamond3" class="addbutton">🗡️</button>
      <div class="taskList" data-for="popup3"></div>
    </div>
  </div>

  <div class="popup" id="popup4">
    <div class="popupContent"><div class="rewards-wrap" id="rewardsWrap" aria-label="보상 상점">
    <h2>보상</h2><br> <button class="addbutton" id="pointsButton" type="button" aria-disabled="true"><strong id="pointsValue">0</strong></button>
  
    <!-- 1) 로즈키 (브론즈/로즈골드) : 1포인트 = 1개 구매 -->
    <section class="reward-card shop" id="shopRose" data-cost="1" aria-label="로즈키 상점">
      <header class="rc-head">
        <h3>로즈키 <span class="icon" aria-hidden="true">✭</span></h3>
        <button type="button" class="btn-buy" id="buyRoseBtn" aria-label="로즈키 1개 구매 (1포인트)">
          구매
        </button>
      </header>
    </section>

    <!-- 2) 실버키 : 조건형 (로즈키 10개당 1회 구매 가능) -->
    <section class="reward-card shop" id="shopSilver" data-unlock-by="rose" data-unlock-step="10" data-cost="1" aria-label="실버키 상점">
      <header class="rc-head">
        <h3>실버키 <span class="icon" aria-hidden="true">🗝️</span></h3>
        <button type="button" class="btn-buy" id="buySilverBtn" disabled>획득</button>
      </header>
    </section>
        
    <!-- 3) 골드키 : 보상형 (실버키 10개당 자동 1개 지급) -->
    <section class="reward-card shop" id="shopGold" data-reward-by="silver" data-reward-step="10" aria-label="골드키 보상">
      <header class="rc-head">
        <h3>골드키 <span class="icon" aria-hidden="true">🔑</span></h3>
        <button type="button" class="btn-buy" id="buyGoldBtn" disabled>획득</button>
      </header>
    </section>
    
    </div></div>
  </div>

  <!-- ===== 입력 스크린 ===== -->
  <div class="screen" id="taskScreen" aria-hidden="true">
    <div class="screen-backdrop"></div>
  
    <div class="screen-panel" role="dialog" aria-modal="true" aria-labelledby="screenTitle">
      <div class="screen-head">
        <h3 id="screenTitle">할 일 추가</h3>
      </div>
  
      <form id="taskForm" class="screen-body">
        <!-- 제목 -->
        <label class="field">
          <span class="label">제목</span>
          <input type="text" name="title">
        </label>
  
        <!-- 설명 -->
        <label class="field">
          <span class="label">설명</span>
          <textarea name="desc" rows="3"></textarea>
        </label>
  
        <!-- 난이도 -->
        <div class="field">
          <span class="label">난이도</span>
          <div class="stars" role="group" aria-label="난이도 선택">
            <button type="button" class="star" data-star="1">1성</button>
            <button type="button" class="star" data-star="2">2성</button>
            <button type="button" class="star" data-star="3">3성</button>
            <button type="button" class="star" data-star="4">4성</button>
          </div>
          <input type="hidden" name="difficulty" value="1">
        </div>
  
        <!-- 날짜 -->
        <label class="field">
          <span class="label">날짜</span>
          <input type="date" name="date">
        </label>
  
        <!-- 태그 -->
        <label class="field">
          <span class="label">태그</span>
          <input type="text" name="tags">
        </label>
  
        <input type="hidden" name="mode" value="create">
        <input type="hidden" name="editId" value="">

        <!-- 액션 버튼 영역 -->
        <div class="actions">
          <button type="button" class="btn-secondary" id="screenCancel">취소</button>
          <button type="submit" class="btn-primary">저장</button>
        </div>

      </form>
    </div>
  </div>

  <!-- 공용 모달 백드롭 -->
  <div id="modal-backdrop" data-close style="display:none;"></div>

  <!-- 상태창 모달 -->
  <div id="ally-status-modal" class="ally-modal" style="display:none;">
    <div class="ally-modal__panel">
      <h1 class="ally-modal__title">상태창</h1>
      <img id="allyStatusPortrait" alt="ally portrait">
      <div class="ally-modal__content" id="ally-status-content"></div>
      <div class="ally-modal__footer">
        <button class="ally-modal__ok">아이콘 변경</button>
        <button class="ally-modal__ok" id="restore-button">복구</button>
        <button class="ally-modal__ok" id="enhance-button">강화</button>
        <button class="ally-modal__ok" data-close>닫기</button>
      </div>
    </div>
  </div>
  
  <!-- 스킬창 모달 -->
  <div id="ally-skill-modal" class="ally-modal" style="display:none;">
    <div class="ally-modal__panel">
      <button class="ally-modal__close" data-close>×</button>
      <h3 class="ally-modal__title">스킬</h3>
      <div class="ally-modal__content" id="ally-skill-content"></div>
      <div class="ally-modal__footer">
        <button class="ally-modal__ok" id="btn-skill-use">사용</button>
        <button class="ally-modal__cancel" data-close>취소</button>
      </div>
    </div>
  </div>

  <!-- 아이콘 파일 선택 (숨김) -->
  <input id="iconFileInput" type="file" accept="image/*" style="display:none" />

  <!-- 아이콘 크롭 모달 -->
  <div id="iconCropModal" class="ally-modal" style="display:none;">
    <div class="ally-modal__panel">
      <h3 class="ally-modal__title">아이콘 자르기 (512×512)</h3>

      <div class="icon-cropper">
        <div class="crop-stage">
          <canvas id="iconCropCanvas" width="512" height="512"></canvas>
          <!-- 마스크(정사각형 프레임) -->
          <div class="crop-mask"></div>
        </div>

        <div class="crop-controls">
          <label>
            확대/축소
            <input id="iconZoom" type="range" min="0.5" max="3" step="0.01" value="1">
          </label>
          <div class="hint">이미지를 드래그하여 위치 조정</div>
        </div>
      </div>

      <div class="ally-modal__footer">
        <button class="ally-modal__cancel" data-close>취소</button>
        <button class="ally-modal__ok" id="iconCropSave">저장</button>
      </div>
    </div>
  </div>
<!-- 적도감 팝업 -->
<div class="popup" id="BestiaryPopup" style="display:none">
  <div class="popupContent">
    <h2>적 도감</h2>

    <!-- 속성 선택 -->
  <div class="row" style="margin:8px 0 12px; display:flex; gap:8px; align-items:center;">
    <label>속성</label>
    <div id="bestAttrBtns" class="attr-btns">
      <button data-attr="1" class="attr-btn purple"></button>
      <button data-attr="2" class="attr-btn red"></button>
      <button data-attr="3" class="attr-btn blue"></button>
      <button data-attr="4" class="attr-btn green"></button>
      <button data-attr="5" class="attr-btn yellow"></button>
    </div>
    <button id="bestClose" style="margin-left:auto">닫기</button>
    <select id="bestAttr" hidden><option value="1"></option><option value="2"></option><option value="3"></option><option value="4"></option><option value="5"></option></select>
  </div>

    <!-- 그리드(기본 목록) -->
    <div id="bestGrid" class="bestiary-grid"></div>

    <div id="bestDetail" class="bestiary-detail" style="margin-top:12px;" hidden>
      <div class="bd-head">
        <img id="bestIcon" alt="아이콘 미리보기">
        <div class="bd-meta">
          <div class="row"><strong id="bestMotifName"></strong><strong id="bestAttrView"></strong></div>
          <div class="btn-row">
            <button id="bestEliteFile">엘리트 보스 일러스트 변경</button><button id="bestEliteClear">복구</button>
          </div>        
        </div>
      </div>

      <div class="bd-actions">
        <div class="col"><h4>보스</h4><img id="bestBossPrev" alt="보스 프리뷰"></div>
        <div class="col"><h4>엘리트 보스</h4><img id="bestElitePrev" alt="엘리트 프리뷰"></div>
      </div>
    </div>

    <!-- 파일 인풋(숨김) -->
    <input id="bestFileInput" type="file" accept="image/*" style="display:none" />
  </div>
</div>

  <script src="plan.js"></script>
  <script src="play.js"></script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker2.js', { scope: './' });
  }
  </script>

</body>

</html>